{"is_source_file": true, "format": "TypeScript", "description": "This file defines a global application store for a Svelte-based real-time messaging app. It manages user, chats, messages, and selection state, and includes functions for initializing the app, selecting chats, sending messages, and handling real-time events. It also imports external APIs, websocket socket handlers, and types.", "external_files": ["$lib/types", "$lib/api/chats", "$lib/api/messages", "$lib/realtime/socket"], "external_methods": ["fetchChats", "fetchMessages", "sendMessage", "onEvent", "connectSocket", "sendRealtimeMessage"], "published": ["appStore", "selectedChat", "selectedMessages", "initApp", "selectChat", "sendMessageAction"], "classes": [], "methods": [{"name": "export async function initApp() { initApp", "description": "Initializes the app by loading chats and establishing websocket connection.", "scope": "", "scopeKind": ""}, {"name": "export async function selectChat(id: ID) { selectChat", "description": "Selects a chat by ID and loads its messages if they haven't been loaded yet.", "scope": "", "scopeKind": ""}, {"name": "export async function sendMessageAction(content: string) { sendMessageAction", "description": "Sends a message via REST API, updates state optimistically, and triggers real-time echo.", "scope": "", "scopeKind": ""}], "calls": ["fetchChats", "connectSocket", "onEvent", "fetchMessages", "restSendMessage", "sendRealtimeMessage"], "search-terms": ["Svelte store", "chat app store", "realtime messaging", "message handling", "websocket integration", "chat selection", "message sending"], "state": 2, "file_id": 17, "knowledge_revision": 51, "git_revision": "", "revision_history": [{"38": ""}, {"50": ""}, {"51": ""}], "ctags": [{"_type": "tag", "name": "AppState", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^interface AppState {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "MessagesByChat", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^type MessagesByChat = Record<ID, Message[]>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "Writable", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^import { derived, writable, type Writable } from \"svelte\\/store\";$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "appStore", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^export const appStore: Writable<AppState> = writable(initial);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "chat", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    const chat = evt.payload as Chat;$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "chats", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const chats = exists ? s.chats.map((c) => (c.id === chat.id ? chat : c)) : [chat, ...s.cha/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "chats", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const chats = s.chats$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "chats", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    const chats = await fetchChats();$/", "language": "TypeScript", "kind": "constant", "scope": "initApp", "scopeKind": "function"}, {"_type": "tag", "name": "chats", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  chats: Chat[];$/", "language": "TypeScript", "kind": "property", "scope": "AppState", "scopeKind": "interface"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    content,$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "created", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    const created = await restSendMessage({ chatId, content } as SendMessageRequest);$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "createdAt", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    createdAt: new Date().toISOString(),$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "err", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    const err = (e as { message?: string }) ?? {};$/", "language": "TypeScript", "kind": "constant", "scope": "initApp", "scopeKind": "function"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  error: null$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  error?: string | null;$/", "language": "TypeScript", "kind": "property", "scope": "AppState", "scopeKind": "interface"}, {"_type": "tag", "name": "exists", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const exists = s.chats.some((c) => c.id === chat.id);$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    const { id, status } = evt.payload as Pick<Message, \"id\" | \"status\">;$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "initApp", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^export async function initApp() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "initial", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^const initial: AppState = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const list = (s.messages[chatId!] || []).map((m) => (m.id === optimistic.id ? created : m)/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const list = (s.messages[chatId!] || []).map((m) => (m.id === optimistic.id ? { ...m, stat/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const list = [...(s.messages[msg.chatId] || []), msg];$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "loading", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  loading: boolean;$/", "language": "TypeScript", "kind": "property", "scope": "AppState", "scopeKind": "interface"}, {"_type": "tag", "name": "loading", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  loading: false,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const messages = Object.fromEntries($/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "messages", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  messages: MessagesByChat;$/", "language": "TypeScript", "kind": "property", "scope": "AppState", "scopeKind": "interface"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    const msg = evt.payload as Message;$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "msgs", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const msgs = await fetchMessages(id);$/", "language": "TypeScript", "kind": "constant", "scope": "selectChat", "scopeKind": "function"}, {"_type": "tag", "name": "optimistic", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  const optimistic: Message = {$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "s", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^      const chats = exists ? s.chats.map((c) => (c.id === chat.id ? chat : c)) : [chat, ...s.cha/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "selectChat", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^export async function selectChat(id: ID) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "selectedChat", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^export const selectedChat = derived(appStore, ($s) => $s.chats.find((c) => c.id === $s.selectedC/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "selectedChatId", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  selectedChatId: ID | null;$/", "language": "TypeScript", "kind": "property", "scope": "AppState", "scopeKind": "interface"}, {"_type": "tag", "name": "selectedMessages", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^export const selectedMessages = derived(appStore, ($s) => ($s.selectedChatId ? $s.messages[$s.se/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "sendMessageAction", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^export async function sendMessageAction(content: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "senderId", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    senderId: userId,$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^    const { id, status } = evt.payload as Pick<Message, \"id\" | \"status\">;$/", "language": "TypeScript", "kind": "constant", "scope": "sendMessageAction", "scopeKind": "function"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/real-time-messaging-platform-22513-22522/chatting_app_frontend/src/lib/stores/appStore.ts", "pattern": "/^  user: User | null;$/", "language": "TypeScript", "kind": "property", "scope": "AppState", "scopeKind": "interface"}], "hash": "d1a435b9951ed474df8f24ebd142c0b4", "format-version": 4, "code-base-name": "chatting_app_frontend", "filename": "chatting_app_frontend/src/lib/stores/appStore.ts", "fields": [{"name": "interface AppState {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "chats: Chat[];", "scope": "AppState", "scopeKind": "interface", "description": "unavailable"}, {"name": "error?: string | null;", "scope": "AppState", "scopeKind": "interface", "description": "unavailable"}, {"name": "loading: boolean;", "scope": "AppState", "scopeKind": "interface", "description": "unavailable"}, {"name": "messages: MessagesByChat;", "scope": "AppState", "scopeKind": "interface", "description": "unavailable"}, {"name": "selectedChatId: ID | null;", "scope": "AppState", "scopeKind": "interface", "description": "unavailable"}, {"name": "user: User | null;", "scope": "AppState", "scopeKind": "interface", "description": "unavailable"}]}